<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta
      name="viewport"
      content="initial-scale=1.0, user-scalable=no, width=device-width"
    />
    <title>事件系统</title>
    <link
      rel="stylesheet"
      href="https://a.amap.com/jsapi_demos/static/demo-center/css/demo-center.css"
    />

    <style>
      html,
      body,
      #container {
        width: 100%;
        height: 100%;
      }
    </style>
  </head>
  <body>
    <div id="container"></div>
    <div class="info" id="text">请用鼠标在地图上操作试试</div>
    <div class="input-card" style="width: 16rem">
      <h4>地图点击相关事件</h4>
      <div>
        <div class="input-item">
          <button id="clickOn" class="btn" style="margin-right: 1rem">
            绑定事件
          </button>
          <button id="clickOff" class="btn">解绑事件</button>
        </div>
      </div>
    </div>
    <script
      type="text/javascript"
      src="https://webapi.amap.com/maps?v=2.0&key=0d4d3eab2644778a146ac0805cef2896"
    ></script>
    <script src="https://a.amap.com/jsapi_demos/static/demo-center/js/demoutils.js"></script>
    <script src="https://unpkg.com/gcoord/dist/gcoord.global.prod.js"></script>
    <script type="text/javascript">
      //初始化地图对象，加载地图
      var map = new AMap.Map("container", {
        zoom: 20,
        center: [120.142654, 30.112257],
        layers: [
          // 卫星
          new AMap.TileLayer.Satellite(),
          // 路网
          new AMap.TileLayer.RoadNet(),
        ],
      });
      var $ = function (elementId) {
        return document.getElementById(elementId);
      };
      // 坐标转换
      function convertFrom(lnglat, type) {
        AMap.convertFrom(lnglat, type, function (status, result) {
          console.log(status, result);
          if (result.info === "ok") {
            var resLnglat = result.locations[0];
            m2 = new AMap.Marker({
              position: resLnglat,
            });
            map.add(m2);
            // 设置标签
            m2.setLabel({
              offset: new AMap.Pixel(20, 20),
              content: "高德坐标系中首开广场（正确）",
            });
          }
        });
      }
      //convertFrom([120.1411168, 30.1124103], 'gps');

      // let marker;
      // function addMarker() {
      //   if (!marker) {
      //     marker = new AMap.Marker({
      //       icon: "//a.amap.com/jsapi_demos/static/demo-center/icons/poi-marker-default.png",
      //       position: [120.142654, 30.112257],
      //     //   offset: new AMap.Pixel(-13, -30)
      //     });
      //     marker.setMap(map);
      //   }
      // }
      // addMarker()
      var gps_pos = [120.1411168, 30.1124103];
      var gps_pos2 = [120.1426287, 30.1123656];
      var gps_pos3 = [120.1426133, 30.1125537];
      var gps_pos4 = [120.1416304, 30.1123517];
      var gps_pos5 = [120.1399471, 30.1117955];
      var gd_true6 = [120.1402356, 30.1118128]
      var gd_true7 = [120.1402444, 30.1116411]
      var gps_pos8 = [30.1116253, 120.1399673]
      
      var amap_pos = gcoord.transform(gps_pos, gcoord.WGS84, gcoord.AMap);
      //var bd_pos = gcoord.transform(gps_pos, gcoord.WGS84, gcoord.Baidu)
      //console.log('baidu', bd_pos)
      var gd_true = [120.145796, 30.110075];
      var gd_true2 = [120.147313, 30.110031];
      var gd_true3 = [120.147297, 30.110224];
      var gd_true4 = [120.146293, 30.110118];
      var gd_true5 = [120.144655, 30.109481];
      var gd_true6 = [120.144932, 30.109508];
      var gd_true7 = [120.144958, 30.109323];
      var gd_true8 = [120.144679, 30.109306];
      

      offset = [gd_true[0] - amap_pos[0], gd_true[1] - amap_pos[1]]
      var amap_offset = [-0.004719361073966866, 0.0023136888359545082];
      console.log(amap_offset);
      [
        [gps_pos, gd_true],
        [gps_pos2, gd_true2],
        [gps_pos3, gd_true3],
      ].forEach((data) => {
        console.log(data);
        map.add(
          new AMap.Marker({
            position: data[1],
            icon: "https://webapi.amap.com/theme/v1.3/markers/n/mark_b.png",
            offset: new AMap.Pixel(-13, -30),
          })
        );
        var _gd = gcoord.transform(data[0], gcoord.WGS84, gcoord.AMap);
        _gd = [_gd[0] + offset[0], _gd[1] + offset[1]];
        map.add(
          new AMap.Marker({
            position: _gd,
            icon: "https://webapi.amap.com/theme/v1.3/markers/n/mark_r.png",
            offset: new AMap.Pixel(-13, -30),
          })
        );
      });
      //   var m2 = new AMap.Marker({
      //     position: amap_pos,
      //     icon: "https://webapi.amap.com/theme/v1.3/markers/n/mark_r.png",
      //     offset: new AMap.Pixel(-13, -30),
      //   });
      //   map.add(m2);

      //   var m3 = new AMap.Marker({
      //     position: gd_true,
      //     icon: "https://webapi.amap.com/theme/v1.3/markers/n/mark_r.png",
      //     offset: new AMap.Pixel(-13, -30),
      //   });
      //   map.add(m3);

      function showInfoClick(e) {
        var text =
          "您在 [ " +
          e.lnglat.getLng() +
          "," +
          e.lnglat.getLat() +
          " ] 的位置单击了地图！";
        document.querySelector("#text").innerText = text;
        console.log(e.lnglat.getLng(), e.lnglat.getLat());
        var m1 = new AMap.Marker({
          position: [e.lnglat.getLng(), e.lnglat.getLat()],
          icon: "https://webapi.amap.com/theme/v1.3/markers/n/mark_r.png",
          offset: new AMap.Pixel(-13, -30),
        });
        map.add(m1);
      }
      function showInfoDbClick(e) {
        var text =
          "您在 [ " +
          e.lnglat.getLng() +
          "," +
          e.lnglat.getLat() +
          " ] 的位置双击了地图！";
        document.querySelector("#text").innerText = text;
      }
      function showInfoMove() {
        var text = "您移动了您的鼠标！";
        document.querySelector("#text").innerText = text;
      }
      // 事件绑定
      function clickOn() {
        log.success("绑定事件!");
        map.on("click", showInfoClick);
        map.on("dblclick", showInfoDbClick);
        map.on("mousemove", showInfoMove);
      }
      // 解绑事件
      function clickOff() {
        log.success("解除事件绑定!");
        map.off("click", showInfoClick);
        map.off("dblclick", showInfoDbClick);
        map.off("mousemove", showInfoMove);
      }

      // 给按钮绑定事件
      document.getElementById("clickOn").onclick = clickOn;
      document.getElementById("clickOff").onclick = clickOff;
    </script>
  </body>
</html>

<!-- <!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no, width=device-width">
    <title>其他坐标变换成高德坐标</title>
    <link rel="stylesheet" href="https://a.amap.com/jsapi_demos/static/demo-center/css/demo-center.css"/>
    <style>
        html,body,#container{
            height:100%;
            width:100%;
        }
        .btn-box{
            position: absolute;
            right: 5rem;
            top: 5rem;
        }
        .btn{
            background: '#0277bd';
            width: 14em;
            margin-left: 3.2rem;  
            margin-top: 0.8rem; 
        }
    </style>
</head>
<body>
<div id="container"></div>
<div class="input-card" style="width:18rem">
    <h4>坐标转换</h4>
    <div id="coordinate">
      <div class="input-item"><input id="gps" name="language" type="radio" checked="checked"><span class="input-text">GPS 坐标转为高德坐标</span></div>
      <div class="input-item"><input id="mapbar" name="language" type="radio"><span class="input-text">图吧坐标转为高德坐标</span></div>
      <div class="input-item"><input id="baidu" name="language" type="radio"><span class="input-text">百度坐标转为高德坐标</span></div>
    </div>
</div>

<script type="text/javascript" src="https://webapi.amap.com/maps?v=2.0&key=0d4d3eab2644778a146ac0805cef2896"></script>
<script type="text/javascript">
    var map = new AMap.Map("container", {
        center: [116.473222,39.993214],
        zoom: 15
    });

    var $ = function(elementId){
        return document.getElementById(elementId);
    };

    // 创建gps坐标位置点标记
    var lnglat = [116.46706996,39.99188446];
    var m1 = new AMap.Marker({
        position: lnglat,
        icon: "https://webapi.amap.com/theme/v1.3/markers/n/mark_r.png"
    });
    map.add(m1);
    m1.setLabel({
        offset: new AMap.Pixel(20, 20),
        content: "GPS 坐标系中首开广场"
    });
    var m2;

    // 坐标转换
    function convertFrom(lnglat, type){
        AMap.convertFrom(lnglat, type, function (status, result) {
          if (result.info === 'ok') {
            var resLnglat = result.locations[0];
            m2 = new AMap.Marker({
                position: resLnglat,
            });
            map.add(m2);
            // 设置标签
            m2.setLabel({
                offset: new AMap.Pixel(20, 20),
                content: "高德坐标系中首开广场（正确）"
            });
          }
        });
    }
    convertFrom(lnglat,'gps');
   

    function setCoordinate() {
        var type = this.id;
        var m1Text = "GPS 坐标系中首开广场";
        if(type == 'mapbar'){
            m1Text = '图吧坐标系中首开广场';
            lnglat = [116.46179996,39.99241446]; // 图吧坐标系下首开广场
        }else if(type == 'baidu'){
            m1Text = '百度坐标系中首开广场';
            lnglat = [116.4798674287,39.9989020876]; // 百度坐标系下首开广场
        }else if(type == 'gps'){
            lnglat = [116.46706996,39.99188446]; // 百度坐标系下首开广场
        }
        // 设置label标签
        m1.setLabel({
            offset: new AMap.Pixel(20, 20),
            content: m1Text
        });
        m1.setPosition(lnglat);
        map.remove(m2);
        // 坐标转换
        convertFrom(lnglat,type);

    }
    
    //绑定radio点击事件
    var radios = document.querySelectorAll("#coordinate input");
    radios.forEach(function(ratio) {
      ratio.onclick = setCoordinate;
    });


</script>
</body>
</html> -->
